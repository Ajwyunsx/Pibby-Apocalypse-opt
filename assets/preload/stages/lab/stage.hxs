var bg;
var dark;
var light;
var bulb;
var stageCurtains;
var flickerTween;
var flickerTween2;

function onCreate()
{	
	bg = new FlxSprite(400, 350);
	bg.loadGraphic(retrieveAsset('images/bg.png', 'image'));
	bg.antialiasing = ClientPrefs.globalAntialiasing;
	bg.setGraphicSize(Std.int(bg.width * 1.7));
	bg.updateHitbox();
	bg.active = false;

	// add to the final array
	add(bg);

	dark = new FlxSprite(550, 100);
	dark.loadGraphic(retrieveAsset('images/dark.png', 'image'));
	dark.setGraphicSize(Std.int(dark.width * 1.7));
	dark.updateHitbox();
	dark.antialiasing = ClientPrefs.globalAntialiasing;
	dark.active = false;
	dark.origin.set(1000, 0);

	// add to the final array
	foreground.add(dark);

	light = new FlxSprite(dark.x, dark.y);
	light.loadGraphic(retrieveAsset('images/light.png', 'image'));
	light.setGraphicSize(Std.int(light.width * 1.7));
	light.alpha = 0.8;
	light.updateHitbox();
	light.antialiasing = ClientPrefs.globalAntialiasing;
	light.active = false;
	light.origin.set(1000, 0);
	flickerTween = FlxTween.tween(light, {alpha: 0}, 0.25, {ease: FlxEase.bounceInOut, type: 4});
	flickerTween.active = true;

	// add to the final array
	foreground.add(light);

	bulb = new FlxSprite(dark.x-dark.width/2.45, dark.y-300);
	bulb.loadGraphic(retrieveAsset('images/bulb.png', 'image'));
	bulb.setGraphicSize(Std.int(bulb.width * 1.7));
	bulb.updateHitbox();
	bulb.antialiasing = ClientPrefs.globalAntialiasing;
	bulb.active = false;
	bulb.origin.set(dark.width/2, 0);
	flickerTween2 = FlxTween.tween(light, {alpha: 0}, 0.25, {ease: FlxEase.bounceInOut, type: 4});
	flickerTween2.active = true;

	// add to the final array
	foreground.add(dark);
	foreground.add(bulb);
}

function onSongStart()
	{
		if (PlayState.curSong == 'Mindless')
			{
				bg.visible = false;
				dark.visible = false;
				light.visible = false;
				bulb.visible = false;
			}
	}

function onMoveCamera(focus:String)
    {
        if (focus == 'dad') {
			if (PlayState.dad.curCharacter != 'jake')
            PlayState.defaultCamZoom = 0.7;
			else
			PlayState.defaultCamZoom = 1;

        }
        else
            PlayState.defaultCamZoom = 0.9;
    }

function onUpdate (elapsed) {
	light.angle = Math.sin((Conductor.songPosition / 1000) * (Conductor.bpm / 60) * 1.0) * 5;
	dark.angle = light.angle;
	bulb.angle = light.angle;
}

function onStepHit(curStep:Int)
{
	if (curStep == 296)
	{
		if (PlayState.curSong == 'Mindless')
			{
				bg.visible = true;
				dark.visible = true;
				light.visible = true;
				bulb.visible = true;
			}
	}
	
	if (curStep == 2080)
	{
		if (PlayState.curSong == 'Suffering Siblings')
		    {
				dark.visible = false;
				light.visible = false;
				bulb.visible = false;
			}
	}
	if (curStep == 2336)
	{
		if (PlayState.curSong == 'Suffering Siblings')
		    {
				dark.visible = true;
				light.visible = true;
				bulb.visible = true;
			}
	}
}

function onEvent(event:String, value1:String, value2:String)
    {
     if (event == 'Apple Filter')
        {
             if (value1 == 'on') 
            {
                bg.visible = false;
				dark.visible = false;
				light.visible = false;
				bulb.visible = false;
            }
             else if (value1 == 'off')
            {
                bg.visible = true;
				dark.visible = true;
				light.visible = true;
				bulb.visible = true;
            }
        }
    }

function onPause()
{
	flickerTween.active = false;
	flickerTween2.active = false;
}

function onResume()
{
	flickerTween.active = false;
	flickerTween2.active = false;
}